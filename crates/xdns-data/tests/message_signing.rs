extern crate paste;

use hex_literal::hex;
use xdns_data::models::algorithm::Algorithm;
use xdns_data::models::credentials::Credentials;

static MESSAGE: &[u8] = b"Xiler - decentralising the centralised";

const PUBLIC_KEY_ED25519: &'static str = "8AD5A3FFB6FFFA0E85F8C4D84A88B20FF2D2A430B0DBF73FEDB892B9EA45B1D6";
const SIGNATURE_ED25519: [u8; 64] = hex!("6A4E49AA279FE3AF06A5A42B189CE179023FE51EEDEE67131AD855339E6216008270290D89459ED65991C8F4E799C82E558C94ED5A8B95B7FDEA61E5844B2F0C");

const PUBLIC_KEY_DILITHIUM2: &'static str = "5a87a0cdc2ea3b4f3fb455520c68918d652304fea7c11ff542cea6c2aa4805b06417678f20aacc708e9032eb3be5d9a157732f38deca5fe19c183043a17569c8f9085c376313568faac7edb845782864030f522ea10101d3d311a07d09a893461c76c5dba79554f50ea537df7f0bd4cd75a225520f3bd7445285dfeba7c0c1a1adcb53cbf178b7ab54469d9421dda3eb4165628270dd5eb90bda95b3a7202e8a74eb90af5c061bd95c2a94cd70e6a8c2c20cfa413f42a7260cd6c63868306021ca6ab969ea9937b34574937d298e5ca18d27693a346fb777309dbff79914497887b4bf5c2b3daa05a175643c06e695e5280eb96ef8fc08e79127457be1107dada44529294673627f732b4efb4514a54687150243f37f86b26a199ae2a6729dc7e54fbb69bb188ef7404aa0773eeb73605ccd31b2c91accc0c721adaff5dd8392af1683007c3fd80e0a0b16bc429bbfb000158891a6b78f10128c5b09e64e809ec00e106dfa890bdc76026e0f659dcbf755c3318ade877c4e115eb2d655857b6f1f61d8d581440ae2a109d00dcf3c9115f4b5c2cfcbe7b999a964125402f1cb207703330cecbcb618c3d9ab1feb5b6f32b6ecd7165bd59ee65618eaba5712062e9d6793dba6f3e9420c83f24114f5545200d012897f3530d0a323d622f4663bc0f455ef4541525ec318822dab9f4a7e030d67dfd5d1959824dd7a74636535a5354df3a2f9f9a11d7d55e09a88630516589adb121873048f23c87859aed38172200a273815bc80ad567b6e60f17e4bc3ea61bc48bb66dab2d51c1fe2b9c03aa286df5ed06039d57d9cc349e160aa0c504430beaff475c77a16887fcd95fe848bb6e6d7372d3b45d45b950f46079114dc568cca478d43caba7ca6d802f7c9a34908ecd437445054cc09edcfb7789ebdf83030582c770f1c416eb7957d718521a30ba1b1167a855835e42d628e21b9fd3431ca7315a81dde02a3bbe539cc81d689e969f302a98b55c89e3fa2172f6a226e90b017de7645fd85e270988fb7f8aa0f9da10708b3fc98f6165de93df06b2f954600db521620dac46f7d8fa03562e395ec12d4698084373f78c20aaa25970834b09254529fbaf2c04166a948b2fab3f25d3c4e1f70b88029d76a63e594fade4a1140dca5335cbbdbc3d55f55e635fe23cb74f60408661ac65790d6606c56e29c659fecefde0e0d3a83ffaead97fcdb45d9043446304ef9b7dc6a135a72354c5d2bbe11e349bf99baa2125f76383d6725376e948fab03d87f9396540639bd9f2f4c3dcfbf5694fd6cb06b6a237f96dde39e88af1dbf47efd2a21eb4e3361a7551a5756f2c8361de3ca96fec97830aae168978fdfdf1d893543fd52d61ea37e1018d3771a8c6c597085761e4284e9f874f1bf524e6d7a3c03660266610d7f9000f9dcbf069fae2e00a67fd198c7977a0102614e20e44f47077165aa6b3ef210dce016a00a57a5027246214435c73bfb2a102f12137f68f8d9d68892bc1ffd2d97dacbdfd3d62a832a40583f57cb146a91993fb4ee75ca63a82c40fdb095237f6605785edc47d751dcf3cbc81c307d137ea922cbbd39341f2011e5581d1d3570d811dbe30d49e250280e998be9a1ed08e1f4fa34225679fb7510baeb0111c2b0e42f99f4211c4568585fe34d6b3aefd7de327418d818d96cacd31a4a0ab740ee43cb4f285d88f75b11f24a5c9cae89dd51246f1edde32a49aa3012841e0038791bc11a73373177c85042e71ec75847e372f8da00e6e66bf3b07c874bccc880922165e110b1ef9b35402a1df966a58ef082730b458d075ec92cf90c2877cacd935dda1e488b318361a4236103338de5cfc673c";
const SIGNATURE_DILITHIUM2: [u8; 2420] = hex!("b08f1374aa9d5e2079e16589aabf3f145f84f3e662dd044dedab1bfc7a67e4648c72cc550194d3a9f3ff444f7f986e91744028bd342e9b701387f9df431d52efde1c21fedb5c0fadc1a9508fe8e90c0ce0b76565c799b9050ddf4aa92c4d2654b59d23dd10b9b2e0e33cb3ec5c32ba2f901fc69556f238d915dbc2ca2806d826c36cda13e0d1c414e60b50c393b48fec215b2e59f601347560bfd20970a478f5d0de4bfe60e6049dc07244268fb24511b63ea59043e750de916ec9a07d641edd1b1849e8d248bdea67bf4c5c3dada261672ffda8c5becec3dd4819d22704a46ff57c362a91fac28a7f1b51a25fac4a6a217f48f404a86ac57f4246bf8f52eb13355fb3c2494c2e7718cdb8f22d4361d6f9ca8c41b300d4320c4d2e9f58f65b660d16239d7abff6861d284a9e4aeecc978742535498c7b83d8415ea561776cfe7fd5f2c7e54b06364eb9f2d23d60505a96c59056f18a9e295ae0aabba549aed69aae23171fa60d1492860f36d80e393ca812d2fbef3bb0d21847d5c3a35deef491813aef1c181990f1639bca5a3ae86c1e8ae8a23e8df4ac22bbe6fad0400bafa9966e11c4d5d305d78b75938262af584e26ddff3ad688e1a725e789c9411e2d4075e314fd62d0d862cd405581696b82323c87f039c3ea4f0837fab872a919ac79c1fe9a8012384719d61c1dc8f1a4db719ff044c9d8e95e487a632d01141823f6b15222ae66f99b0b62e88c5f73c83ff223213cfe741b071278b91b5c6649ac31d12a0c7b3bda7cc4817149055099b48f02ba23b5de33038348dc2d87784c48f6a63647e20f2ed256025b8cf0b46ea0e48764eef8df1e7d5423b4f64645b1b1a75678228f9ae842984079c2bafb20ac818faf9606f0cb9eef3472f9782b9744b48f5e1d9d00f42e4b35b913e30bbd49e64c36f9c70533aa63fd9c05edc80b48944b51278eb8a335b82c3f466db5fc5653eb7994c9899df44505a3f0dfca2a3eb6b0781fde9223ecf1d48e868deba780f8760fa2ead458f92af25b2484e52a1916f47f6d59d0b125120e6eae88f71e25a90d96e7af212f8d0d5c06d1e1105398a4e175ca556e75a2886002edf50cb7f747eff984a41f683b800cd279429d9474e3c203f9a61e255247c220737d0d1646166c462cbf73219265d808315af02fcc7974f4081760e2633211a2b441ce8144e8f8078d098dcd10ecd7962b06261ec04d0678d3d46a9a29686cefe28ef557e42948ab9e972d58535971b0abedcd39d16e3682cb9450f894d27a5f07b13ed41cd946a1fd6bf4c673dcd799363236f51b762b3e77286ca72aab0efdae1d943682d5f712880e7218702ffeff75a6dc0c257d7830b42fe43fb445cfdaa349b1948b6b25213b6562fbf7d40e47c13e05d12085751c6c5f04487f6075befe6ac6ba5413aa99d0026396562cd1803ba580e11bc630eb05c6e524a0c458ca6f875407173b9a4822e515e640f3af5fb746468545034674c9bdf097c6e9ebb418c6cd4cc142e3decdd27b75c3ed93c7b3fdaabc07b0cd539b06e2688113f0a993d4665fa06bf34658d780f829310b802448cb06bde96945b6d77428e5df76385671e25738ae66f454d028c4041fb2cb059b51ab28e658c1359edae62db2204327acc92e1de80e35a8b58b529e40f2b432bea45fb238d5b72d5ab74b2a2622c24b7c9442503a64a739e6a415a2e3ad254ee4b69d2a84db1818e7e91ed32f9a1aa8255f7472c7ed8fe3b63c3a631f6c0e86e05652639ae739a2aca153f06c52ab614c8ba58ddd68fd19c11093376aec72fbe526541d88acd7e7c0baa0dce7bb8bc996155618ec5789d723dd9d0b5986fb19232fe4de7e5f00580ba8bbc809daeafb3bb2ca23c678fd640dfb0227162a7bb35e2a2ddb8bb257a50db51893a75272bb6bd5bacb708c28720dfeee3e31bdc53deea396a423eeeaefe8ea8f03343bbc209533e113bcef37bc9874e9afa47fa3764794130f19dece7e64d60f40e9b736d96c6d0cff4659b93ecfc8e6d9332238f752c6cf01d9836abf7a53873a1148d23b49158533d32743a49335a3d4b6fe40f4a80fe637ebe6a60d88019c0106bb263f4a3e7bb75d0eb4066f9e85974a903e4016b36128c9271df4baae2b41cb037628f91eec326dca0ff8d2dbfa436919e543fe20a346420377571339779315affdf154f9893b5cfe6d08ba372e97cc5818eddcef9f54ab71b5ff0d6aba0199df455afeeced7e7893c909e30ba22c3c4a1e01a7d18964a53508e0370058e7b6167b64e82bc369b69c4fc1fe8d811ca6acbb8a4c19d731504a0abef98112eead19cd225a22884b8376e75a9a0293cca4da02abf33d2d48d96795be884c67a4aa18652476bab3e4ce7731fd382a02cfb7eadef7c30a5713e90544e9d6bbe32bb65286583411c3b073f0e88a7297454be057f08effe9af617f9907647a2e32511f3b57d394a69ff7bc4a178fc7ecd4ac3e09daeaf61d7e3d8db5f6fa2beb700cf312a62803b756f5605f3d1093769e62a10534a68808a1b93c6e8819929eef55da52efdc8085e2dab67187deba3cd2c56ed563c1a9cf6bfc66a576f1b837e9bb44875ac9c4424f57f9c27c2831d333241e586d51c2d2913c6bb93e1142a9f7ac2d16dfb9568949f051755cbd7158c23ae1157cc5e04d92cb5bb059ea32fecf9e1aad9367458db998902cce3fa98efd074e82f8fcb628c84e6c23ad2b403ffe25411d8df417683070bf5166c92b5d65838e6c471ac556d3a4370639f48e1836b5f620e16b298ecf45753ad592588eb5c251d11b8a2601e8247aa36873275c80f52d0f5c4af973cb14713b2ce29054387c99d8273e4be7097e16a7ee64334bc16ffb2b1b61446a988aee670e474d2d65450ca334258ac47aa3891c6e5935dfd24fca77148cf03932f715474c652850d72fa5d45d2904aaa62b4f3914a0002bc00ae5adf63ab6d49c390b0de7b856ecbe91e3168249f29d35ebe3571d0c2c1f398ef9ea63cbdf09ba89c8e5cf536b7ce52553fa4513226605cfb6766078f2978fce59533c90730daa7df8eb7fae9643fffbf0c3b6e9de26ab6fd67b2d4c303bb8208eec64d4ff94a49f0cbfccc1f051640c1f08f489548b49f79f8ea8b5e784df25bdec18e1ad828ad572eed380895cf5236cab1dcd3d228c606025f35c77b17fd727ac34ecf7a3a78d6170f9688df52007043206d5e66ead01edc48e26b470fbe7ab1152d5488d20753d08a15f858485b54035ad50df3d045ad9a0c6c1b8ab884d124eaed159b9e786dcd14c5cab99669a4c9ede68c46d0dae305263d6e7d8899b6b7cddbeef116292a2f484a4d57848d9dd4dd020b1e536d788999a7b7cdd0d9e1060811223f47565b6a6b8baeb7c8d8fa0000000000000000000000000000000000000000000000000d1a2838");

fn test_verifier(algorithm: Algorithm, public_key: &str, signature: &[u8]) {
    let decoded_public_key = hex::decode(public_key).unwrap();
    let verifier = algorithm.get_verifier(&decoded_public_key).unwrap();
    let is_valid = verifier.try_is_valid(MESSAGE, &signature).unwrap();
    assert!(is_valid);
}

fn test_credentials(algorithm: Algorithm, public_key: &str, signature: &[u8]) {
    let mut credentials = Credentials::new(algorithm, public_key.to_string());
    let is_valid = credentials.try_is_valid(MESSAGE, &signature).unwrap();
    assert!(is_valid);
}

macro_rules! generate_test_function {
    ($name:ident, $method:ident) => {
         paste::item! {
            #[test]
            fn [<$method _ $name:lower>]() {
                $method(Algorithm::[<$name:lower:camel>], [<PUBLIC_KEY_ $name:upper>], &[<SIGNATURE_ $name:upper>]);
            }
        }
    };
}

macro_rules! generate_tests {
    ($($name:ident),*) => {
        $(
            generate_test_function!($name, test_verifier);
            generate_test_function!($name, test_credentials);
        )*
    };
}

generate_tests!(
    Ed25519,
    Dilithium2
);